/*!
 * logline v1.0.0 (https://github.com/latel/logline#readme)
 * Copyright 2016, latel <latelx64@gmail.com>
 * MIT license
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Logline=t():e.Logline=t()}(this,function(){return function(e){function t(n){if(o[n])return o[n].exports;var r=o[n]={exports:{},id:n,loaded:!1};return e[n].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var o={};return t.m=e,t.c=o,t.p="",t(0)}([function(e,t,o){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),l=o(1),c=r(l),u=o(4),f=r(u),s=o(3),p=n(s),y=function h(e){return h._checkProtocol(),new h._protocol(e)},d=function(){function e(t){return a(this,e),e._checkProtocol(),new e._protocol(t)}return i(e,null,[{key:"_checkProtocol",value:function(){e._protocol||p.displayError('you must choose a protocol with "using" method.')}},{key:"deploy",value:function(t,o,n,r){e._checkProtocol(),e._reportTo?e._protocol.all(function(e){var a,i,l,c=new XMLHttpRequest,u=[];for(c.upload.onprogress=o,c.onload=function(){200===c.status?"function"==typeof n&&n():"function"==typeof r&&r()},c.onerror=function(){"function"==typeof r&&r()},c.open("POST",y._reportTo),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a=e.pop();){l=[];for(i in a)a.hasOwnProperty(i)&&a[i]&&l.push(a[i]);u.push(l.join("\t"))}c.withCredentials=!0,u.unshift(location.host+(t?": "+t:"")),c.send("data="+(escape(u.join("\n"))||"no data"))}):p.displayError("report address is not configed.")}},{key:"keep",value:function(t){try{e._checkProtocol(),e._protocol.keep(t)}catch(o){p.displayError("unable to clean log database.")}return this}},{key:"clean",value:function(){try{e._checkProtocol(),e._protocol.clean()}catch(t){p.displayError("unable to clean log database.")}return this}},{key:"using",value:function(t){if(e._protocol)return this;switch(t){case"localstorage":e._protocol=c["default"];break;case"websql":default:e._protocol=f["default"]}return e._protocol.init(),this}},{key:"reportTo",value:function(t){return e._reportTo=t,this}}]),e}();d._protocol=null,d._reportTo=null,e.exports=d},function(e,t,o){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),u=o(2),f=r(u),s=o(3),p=n(s),y=function(e){function t(){var e;a(this,t);for(var o=arguments.length,n=Array(o),r=0;r<o;r++)n[r]=arguments[r];return i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n)))}return l(t,e),c(t,[{key:"_record",value:function(e,t,o){var n=window.localStorage.getItem("logline")?JSON.parse(window.localStorage.getItem("logline")):[];n.push({time:Date.now(),namespace:this._namesapce,level:e,descriptor:t,data:o});try{window.localStorage.setItem("logline",JSON.stringify(n))}catch(r){p.displayError("error inserting record")}}}],[{key:"init",value:function(){window.localStorage.getItem("logline")||window.localStorage.setItem("logline",JSON.stringify([]))}},{key:"all",value:function(e){e(JSON.parse(window.localStorage.getItem("logline")))}},{key:"keep",value:function(e){var t=e?(window.localStorage.getItem("logline")?JSON.parse(window.localStorage.getItem("logline")):[]).filter(function(t){return t.time>=Date.now()-24*(e||2)*3600*1e3}):[];window.localStorage.setItem("logline",JSON.stringify(t))}},{key:"clean",value:function(){window.localStorage.removeItem("logline")}}]),t}(f["default"]);t["default"]=y},function(e,t,o){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),i=o(3),l=n(i),c=function(){function e(t){r(this,e),this._namesapce=t}return a(e,[{key:"_record",value:function(e,t,o){l.displayError("_record is not implemented.")}},{key:"info",value:function(){this._record.apply(this,Array.prototype.unshift.call(arguments,"info")&&arguments)}},{key:"warn",value:function(){this._record.apply(this,Array.prototype.unshift.call(arguments,"warning")&&arguments)}},{key:"error",value:function(){this._record.apply(this,Array.prototype.unshift.call(arguments,"error")&&arguments)}},{key:"critical",value:function(){this._record.apply(this,Array.prototype.unshift.call(arguments,"critical")&&arguments)}}]),e}();t["default"]=c},function(e,t){"use strict";function o(e){window.console&&window.console.error&&window.console.error("logline: "+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.displayError=o},function(e,t,o){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t["default"]=e,t}function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),u=o(2),f=r(u),s=o(3),p=n(s),y=function(e){function t(){var e;a(this,t);for(var o=arguments.length,n=Array(o),r=0;r<o;r++)n[r]=arguments[r];return i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(n)))}return l(t,e),c(t,[{key:"_record",value:function(e,o,n,r){var a=this,i=arguments;if(!r||r<10)if(t._inited)try{t._db.transaction(function(t){t.executeSql("INSERT INTO logs (time, namespace, level, descriptor, data) VALUES(?, ?, ?, ? ,?)",[Date.now(),a._namesapce,e,o,void 0===n||""===n?"":JSON.stringify(n)||""],function(){},function(e){throw e})})}catch(l){p.displayError("error inserting record")}else setTimeout(function(){switch(i.length){case 2:Array.prototype.push.call(i,"",1);break;case 3:Array.prototype.push.call(i,1);break;case 4:Array.prototype.push.call(i=Array.prototype.slice.call(i,0,3),r+1)}a._record.apply(a,i)})}}],[{key:"init",value:function(){"openDatabase"in window||p.displayError("your platform does not support websql.");try{t._db=window.openDatabase("logline","1.0","cats loves logs",5085593.6),t._db.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS logs (time, namespace, level, descriptor, data)",[],function(){t._inited=!0},function(){t._inited=!1})})}catch(e){p.displayError("unable to init log database.")}}},{key:"all",value:function(e){try{t._db.transaction(function(t){t.executeSql("SELECT * FROM logs",[],function(t,o){for(var n=[],r=o.rows.length;--r>=0;)n.push(o.rows.item(r));e(n)},function(e){throw e})})}catch(o){p.displayError("unable to collect logs from database.")}}},{key:"keep",value:function(e){try{t._db.transaction(function(t){e?t.executeSql("DELETE FROM logs WHERE time < ?",[Date.now()-24*(e||2)*3600*1e3],function(){},function(e){throw e}):t.executeSql("DELETE FROM logs",[],function(){},function(e){throw e})})}catch(o){p.displayError("unable to clean logs from database.")}}},{key:"clean",value:function(){try{t._db.transaction(function(e){e.executeSql("DROP TABLE logs",[],function(){},function(e){throw e})})}catch(e){p.displayError("unable to clean log database.")}}}]),t}(f["default"]);t["default"]=y}])});